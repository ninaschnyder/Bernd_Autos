---
title: "Autoimmatrikulationen Kanton Luzern"
subtitle: "factor_LU"
author: "Nina & Radek"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: 
  html_document: 
    highlight: pygments
    keep_md: no
    number_sections: yes
    theme: united
    toc: yes
    toc_depth: 4
    toc_float: yes
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE, fig.width=8, fig.height=6, dpi=300, out.width="800px", out.height="600px")

knitr::opts_knit$set(root.dir = rprojroot::find_rstudio_root_file())
set.seed(12345)
options(scipen = 999)

library(pacman) 
p_load(tidyverse, readxl, janitor)
```

## Factor Luzern

We would like to know the number of new registered campervans (Wohnwagen) and light cargo transport (leichte Sachentransportfahrzeuge) up to 8t in the Canton Lucerne. Every year, [Auto Swiss](https://www.auto.swiss/statistiken/nutzfahrzeuge) publishes data on the number of new registered cars in these categories. However, they refer to the whole of Switzerland. The [Bundesamt fÃ¼r Statistik (BfS)](https://www.bfs.admin.ch/bfs/de/home/statistiken/mobilitaet-verkehr/verkehrsinfrastruktur-fahrzeuge/fahrzeuge/strassenfahrzeuge-bestand-motorisierungsgrad.html) on the other hand publishes total car and truck registration according to car category and canton.

From the BfS information, we can derive a yearly proportion of cars in each category that were registered in the Canton Lucerne. We will use this factor to extrapolate the number of sub-categories of Auto Schweiz data for the Canton Lucerne.

```{r eval=FALSE, include=FALSE}
for(i in 2019:2010) {
  
  print(paste("doing year", as.character(i)))
  
  if(i >= 2017 & i <= 2019) {
    
    temp <- read_excel("data/BFS/raw/BFS_Fahrzeugbestand_CH.xlsx",
                       sheet = as.character(i), 
                       na = "-", skip = 2) %>% 
      clean_names() %>%
      remove_empty(c("rows", "cols")) %>% 
      select(x1, personen_wagen, sachen_transport_fahrzeuge) %>% 
      dplyr::rename(canton = x1,
                    pw = personen_wagen,
                    stf = sachen_transport_fahrzeuge) %>% 
      filter(canton %in% c("Total", "Luzern")) %>% 
      pivot_wider(id_cols = canton, 
                  names_from = canton,
                  values_from = c(pw, stf)) %>% 
      mutate(year = i,
             pw = pw_Luzern / pw_Total,
             stf = stf_Luzern / stf_Total) %>% 
      select(-starts_with("pw_"), -starts_with("stf_")) %>% 
      pivot_longer(-year, names_to = "type", values_to ="factor")
    
    if(i == 2019) {
      
      BfS <- temp
      
    } else {
      
      BfS <- bind_rows(BfS, temp)
      
    }
  }
  
  # different excel format on top to skip rows :/
  if(i >= 2010 & i <= 2016) {
    
    temp <- read_excel("data/BFS/raw/BFS_Fahrzeugbestand_CH.xlsx",
                       sheet = as.character(i), 
                       na = "-", skip = 4) %>% 
      clean_names() %>%
      remove_empty(c("rows", "cols")) %>% 
      select(x1, personen_wagen, sachen_transport_fahrzeuge) %>% 
      dplyr::rename(canton = x1,
                    pw = personen_wagen,
                    stf = sachen_transport_fahrzeuge) %>% 
      filter(canton %in% c("Total", "Luzern")) %>% 
      pivot_wider(id_cols = canton, 
                  names_from = canton,
                  values_from = c(pw, stf)) %>% 
      mutate(year = as.integer(i),
             pw = pw_Luzern / pw_Total,
             stf = stf_Luzern / stf_Total) %>% 
      select(-starts_with("pw_"), -starts_with("stf_")) %>% 
      pivot_longer(-year, names_to = "type", values_to ="factor")
    
    BfS <- bind_rows(BfS, temp)
    
  }
}

ggplot(BfS, aes(x = year, 
                y = factor, 
                color = type)) +
  scale_x_continuous(breaks = c(2010:2019)) +
  scale_y_continuous(limits = c(0, 0.075)) +
  geom_line()
```


